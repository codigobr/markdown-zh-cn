// Indexador do lunr.js

(function ($) {
  $(document).ready(function() {

    window.index = lunr(function () {
      this.field('title', {boost: 10});
      this.field('body');
      this.ref('href');
    });
    window.index.pipeline.reset();

    window.index.add({
      href: 'https://markdown.net.br/introducao/',
      title: 'Introdução',
      body: 'O que é o Markdown, Por que usar o Markdown, Como funciona o Markdown, Para que serve o Markdown, Sabores do Markdown'
    });

    // Cria o indexador
    window.index.add({
      href: 'https://markdown.net.br/sintaxe-basica/',
      title: 'Sintaxe básica',
      body: 'Quase todos os aplicativos Markdown suportam a sintaxe básica descrita no documento de design original de John Gruber. Existem pequenas variações e discrepâncias entre os processadores Markdown - essas são anotadas em linha sempre que possível. Links, link'
    });

    window.index.add({
      href: 'https://markdown.net.br/sintaxe-estendida/',
      title: 'Sintaxe Estendida',
      body: 'A sintaxe básica descrita no documento de design original de John Gruber adicionou muitos dos elementos necessários no dia a dia, mas não foi suficiente para algumas pessoas. É aí que entra a sintaxe estendida. Vários indivíduos e organizações decidiram estender a sintaxe básica adicionando mais elementos, como tabelas, blocos de código, realce de sintaxe, vinculação automática de URL e notas de rodapé. Esses elementos podem ser ativados usando uma linguagem de marcação leve que se baseia na sintaxe básica do Markdown ou adicionando uma extensão a um processador Markdown compatível.'
    });

    window.index.add({
      href: 'https://markdown.net.br/referencia-rapida/',
      title: 'Referência Rápida, Folha de Dicas, Consulta Rápida',
      body: 'Uma referência rápida à sintaxe do Markdown. Esta folha de dicas do Markdown fornece uma visão geral rápida de todos os elementos que compõem a sintaxe da linguagem.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/',
      title: 'Ferramentas',
      body: 'Os melhore aplicativos, editor, extensões, plugins e componentes que são compatíveis com o Markdown. Este é um diretório abrangente de ferramentas relacionadas ao Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/bear/',
      title: 'Bear',
      body: 'O Bear é um aplicativo de anotações do Markdown para dispositivos macOS e iOS.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/boostnote/',
      title: 'Boostnote',
      body: 'O Boostnote é uma aplicação de anotação para desenvolvedore baseada no Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/byword/',
      title: 'Byword',
      body: 'O Byword é um editor de Markdown disponível para macOS e iOS.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/codimd/',
      title: 'Codimd',
      body: 'O CodiMD é um editor de Markdown que permite colaboração em tempo real, além de ser código fonte aberto.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/dillinger/',
      title: 'Dillinger',
      body: 'Dillinger é um editor de Markdown on-line projetado para que você possa editar Markdown em qualquer lugar.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/docusaurus/',
      title: 'Docusaurus',
      body: 'O Docusaurus converte arquivos Markdown em um site de documentação.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/ghost/',
      title: 'Ghost',
      body: 'O Ghost é um CMS de código aberto conhecido por sua velocidade, simplicidade e facilidade de uso.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/gitbook/',
      title: 'GitBook',
      body: 'O GitBook é uma solução de hospedagem para sites de documentação e bases de conhecimento.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/github-pages/',
      title: 'Github Pages',
      body: 'O GitHub Pages é um serviço gratuito que transforma arquivos Markdown em um site.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/hugo/',
      title: 'Hugo',
      body: 'Hugo é um gerador de site estático que converte arquivos Markdown em um site.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/ia-writer/',
      title: 'iA Writer',
      body: 'O iA Writer é um dos editores Markdown mais estabelecidos e amplamente aclamados.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/imdone/',
      title: 'Imdone',
      body: 'Imdone é um gerenciador de tarefas no estilo Kanban baseado em Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/jekyll/',
      title: 'Jekyll',
      body: 'O Jekyll é um gerador de site estático que converte arquivos Markdown em um site.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/joplin/',
      title: 'Joplin',
      body: 'Joplin é um aplicativo de anotações que respeita a sua privacidade.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/macdown/',
      title: 'MacDown',
      body: 'O MacDown é um dos melhores editores do Markdown disponíveis para o macOS.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/mark-text/',
      title: 'Mark Text',
      body: 'O Mark Text é um editor popular, gratuito e de código aberto desenvolvido para o Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/markdeep/',
      title: 'Markdeep',
      body: 'O Markdeep transforma qualquer arquivo do Markdown em um arquivo HTML independente.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/markdown-here/',
      title: 'Markdown Here',
      body: 'Markdown Here está uma extensão do navegador que converte o texto Markdown em formulários da web.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/mattermost/',
      title: 'Mattermost',
      body: 'O Mattermost é um aplicativo de mensagens e colaboração em equipe de código fonte aberto.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/mkdocs/',
      title: 'MkDocs',
      body: 'O MkDocs é um gerador de website estático para a criação de sites de documentação.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/madoko/',
      title: 'Madoko',
      body: 'Madoko é um aplicativo para escrever artigos profissionais e muito mais.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/notable/',
      title: 'Notable',
      body: 'Notable é uma aplicação de anotação básica com excelente suporte ao Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/notion/',
      title: 'Notion',
      body: 'O Notion é uma solução de gerenciamento de conhecimento "tudo em um" para todos.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/reddit/',
      title: 'Reddit',
      body: 'O Reddit é uma comunidade online popular que suporta postagem usando Markdown.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/simplenote/',
      title: 'Simplenote',
      body: 'Simplenote é um aplicativo de anotações Markdown multiplataforma.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/slack/',
      title: 'Slack',
      body: 'O Slack é um aplicativo de mensagens e colaboração em equipe.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/squarespace/',
      title: 'Squarespace',
      body: 'O Squarespace é um serviço popular baseado em assinatura para a criação de sites.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/stackedit/',
      title: 'StackEdit',
      body: 'O StackEdit é um poderoso editor de Markdown on-line que você pode usar em qualquer lugar.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/standard-notes/',
      title: 'Standard Notes',
      body: 'O Standard Notes é um aplicativo de anotações elegante e de código aberto.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/trello/',
      title: 'Trello',
      body: 'O Trello é um aplicativo de gerenciamento de projetos no estilo kanban.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/typora/',
      title: 'Typora',
      body: 'Typora é um editor simples e configurável, projetado para anotações e documentos.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/ulysses/',
      title: 'Ulysses',
      body: 'Ulysses é um aplicativo de escrita popular para dispositivos macOS e iOS.'
    });

    window.index.add({
      href: 'https://markdown.net.br/ferramentas/zettlr/',
      title: 'Zettlr',
      body: 'Zettlr é um editor de Markdown de código aberto desenvolvido para redação acadêmica.'
    });

    window.index.add({
      href: 'https://markdown.net.br/sabores/',
      title: 'Sabores',
      body: 'Essa é uma lista detalhada dos sabores, variações e alternativas da sintaxe do Markdown e como usá-las.'
    });

    window.index.add({
      href: 'https://markdown.net.br/sabores/gfm/',
      title: 'GFM',
      body: 'Github flavored Markdown, Esta especificação formal é baseada no CommonMark Spec de John MacFarlane e licenciada sob Creative Commons BY-SA. Sabor do Markdown do Github.'
    });

    // icon click
    $('ul#nav-mobile li.search .search-wrapper i.material-icons').click(function() {
      if ($('.search-results .focused').length) {
        $('.search-results .focused').first()[0].click();
      } else if ($('.search-results').children().length) {
        $('.search-results').children().first()[0].click();
      }
    });

    var renderResults = function(results) {
      var resultsContainer = $('.search-results');
      resultsContainer.empty();
      Array.prototype.forEach.call(results, function(result) {
        var resultDiv = $('<a href="' + result[1] + '">' + result[0] + '</a>');
        resultsContainer.append(resultDiv);
      });
    };

    var debounce = function (fn) {
      var timeout;
      return function () {
        var args = Array.prototype.slice.call(arguments),
            ctx = this;

        clearTimeout(timeout);
        timeout = setTimeout(function () {
          fn.apply(ctx, args);
        }, 100);
      };
    };

    $('input#search').focus(function() { $(this).parent().addClass('focused'); });
    $('input#search').blur(function() {
      if (!$(this).val()) {
        $(this).parent().removeClass('focused');
      }
    });

    $('input#search').on('keyup', debounce(function (e) {
      if ($(this).val() < 2) {
        renderResults([]);
        return;
      }

      if (e.which === 38 || e.which === 40 || e.keyCode === 13) return;

      String.prototype.trimRight = function(charlist) {
        if (charlist === undefined)
          charlist = "\s";

        return this.replace(new RegExp("[" + charlist + "]+$"), "");
      };

      var query = $(this).val();
      var results = window.index.search(query).slice(0, 6).map(function (result) {
        var href = result.ref.split('https://markdown.net.br/')[1];
        console.log(result);
        href = href.trimRight("/");
        // alert(href);
        href = href.replace("/", ' <i class="fas fa-chevron-right" style="margin: 0 5px;color: #989898;"></i> ')
        // alert(href);
        return [href, result.ref];
      });
      renderResults(results);
    }));


    $('input#search').on('keydown', debounce(function (e) {
      // Escape.
      if (e.keyCode === 27) {
        $(this).val('');
        $(this).blur();
        renderResults([]);
        return;
      } else if (e.keyCode === 13) {
        // enter
        if ($('.search-results .focused').length) {
          $('.search-results .focused').first()[0].click();
        } else if ($('.search-results').children().length) {
          $('.search-results').children().first()[0].click();
        }
        return;
      }

      // Arrow keys.
      var focused;
      switch(e.which) {
        case 38: // up
          if ($('.search-results .focused').length) {
            focused = $('.search-results .focused');
            focused.removeClass('focused');
            focused.prev().addClass('focused');
          }
          break;

        case 40: // down
          if (!$('.search-results .focused').length) {
            focused = $('.search-results').children().first();
            focused.addClass('focused');
          } else {
            focused = $('.search-results .focused');
            if (focused.next().length) {
              focused.removeClass('focused');
              focused.next().addClass('focused');
            }
          }
          break;

        default: return; // exit this handler for other keys
      }
      e.preventDefault();
    }));
  });
}( jQuery ));